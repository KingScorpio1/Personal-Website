{% extends "base.html" %}
{% block title %}Portfolio - Sule Smith{% endblock %}

{% block content %}
<style>
    .category-badge {
        background-color: #3700b3;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    /* Image Styles */
    .project-img, .slide img {
        width: 100%;
        height: 250px;
        object-fit: cover;
        border-radius: 5px;
        background-color: #333;
    }
    
    /* Slideshow Container */
    .slideshow-container {
        position: relative;
        width: 100%;
        height: 250px;
        margin-bottom: 15px;
        overflow: hidden;
        border-radius: 5px;
    }
    
    /* Hide slides by default */
    .slide {
        display: none;
        width: 100%;
        height: 100%;
    }
    
    /* Navigation buttons */
    .prev, .next {
        cursor: pointer;
        position: absolute;
        top: 50%;
        width: auto;
        padding: 10px;
        margin-top: -22px;
        color: white;
        font-weight: bold;
        font-size: 18px;
        transition: 0.3s ease;
        background-color: rgba(0,0,0,0.3);
        user-select: none;
        border-radius: 0 3px 3px 0;
        z-index: 10;
    }
    .next {
        right: 0;
        border-radius: 3px 0 0 3px;
    }
    .prev:hover, .next:hover {
        background-color: rgba(0,0,0,0.8);
    }

    /* Fade Animation */
    .fade {
        animation-name: fade;
        animation-duration: 1.5s;
    }
    @keyframes fade {
        from {opacity: .4} 
        to {opacity: 1}
    }
</style>

<div style="text-align: center; padding: 2rem;">
    <h1>My Projects</h1>
    <p>Robotics, Software Development, and Engineering Design.</p>
</div>

<div class="portfolio-grid">
    {% for project in projects %}
    <div class="project-card">
        
        <!-- CASE 1: SLIDESHOW (Multiple Images) -->
        {% if project.images %}
            <div class="slideshow-container" id="slideshow-{{ loop.index }}">
                {% for img in project.images %}
                <div class="slide fade">
                    <img src="{{ url_for('static', filename='img/' + img) }}">
                </div>
                {% endfor %}
                
                <!-- Manual Controls -->
                <a class="prev" onclick="plusSlides(-1, 'slideshow-{{ loop.index }}')">‚ùÆ</a>
                <a class="next" onclick="plusSlides(1, 'slideshow-{{ loop.index }}')">‚ùØ</a>
            </div>

        <!-- CASE 2: SINGLE IMAGE -->
        {% elif project.image %}
            <img src="{{ url_for('static', filename='img/' + project.image) }}" alt="{{ project.title }}" class="project-img">
        {% endif %}

        <!-- Project Details -->
        <span class="category-badge">{{ project.category }}</span>
        <h3 style="margin-top: 10px;">{{ project.title }}</h3>
        <p>{{ project.description }}</p>
        <br>
        
        <!-- Buttons -->
        {% if project.video_url %}
            <a href="#" 
            onclick="openVideoModal('{{ project.video_url }}', '{{ project.title }}'); return false;" 
            class="btn" style="font-size: 0.9rem;">
                ‚ñ∂ {{ project.link_text }}
            </a>
        {% elif project.url and project.url != '#' %}
            <a href="{{ project.url }}" target="_blank" class="btn-outline" style="font-size: 0.9rem;">üîó {{ project.link_text }}</a>
        {% endif %}
    </div>
    {% endfor %}
</div>

<!-- Video Modal -->
<div id="videoModal" class="modal" style="display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.9);">
    <span onclick="closeVideoModal()" style="position:absolute; top:15px; right:35px; color:#f1f1f1; font-size:40px; font-weight:bold; cursor:pointer;">√ó</span>
    <div style="margin:auto; display:block; width:80%; max-width:900px; margin-top:5%;">
        <iframe id="videoIframe" style="width:100%; height:500px; border:none;" allowfullscreen></iframe>
    </div>
</div>

<script>
function openVideoModal(url, title) {
    document.getElementById('videoIframe').src = url;
    document.getElementById('videoModal').style.display = 'block';
}

function closeVideoModal() {
    document.getElementById('videoModal').style.display = 'none';
    document.getElementById('videoIframe').src = ''; // stop video
}

// Close modal when clicking outside
window.onclick = function(event) {
    var modal = document.getElementById('videoModal');
    if (event.target == modal) {
        closeVideoModal();
    }
}
</script>

<!-- JavaScript for Auto-Play & Manual Slideshow -->
<script>
    // Objects to store the state of each slideshow
    let slideIndices = {}; // Keeps track of current slide number
    let slideTimers = {};  // Keeps track of the auto-play timer

    // Initialize all slideshows when page loads
    document.addEventListener("DOMContentLoaded", function() {
        let containers = document.querySelectorAll('.slideshow-container');
        containers.forEach(function(container) {
            let id = container.id;
            slideIndices[id] = 1; // Start at slide 1
            showSlides(1, id);    // Show it
        });
    });

    // Function called by Next/Prev buttons
    function plusSlides(n, slideshowId) {
        // 1. Stop the auto-player (so it doesn't jump immediately after you click)
        clearTimeout(slideTimers[slideshowId]);
        
        // 2. Calculate new index
        let current = slideIndices[slideshowId] || 1;
        
        // 3. Show new slide
        showSlides(current + n, slideshowId);
    }

    // Main function to display slides
    function showSlides(n, slideshowId) {
        let container = document.getElementById(slideshowId);
        if(!container) return;

        let slides = container.getElementsByClassName("slide");
        if(slides.length === 0) return;

        // Wrap around logic (Last -> First, First -> Last)
        if (n > slides.length) {n = 1}
        if (n < 1) {n = slides.length}
        
        // Update stored index
        slideIndices[slideshowId] = n;

        // Hide all slides
        for (let i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";  
        }
        
        // Show the current slide
        slides[n-1].style.display = "block";  

        // 4. Restart the Auto-Play Timer (Run again in 4 seconds)
        // We clear any existing timer first just to be safe
        clearTimeout(slideTimers[slideshowId]);
        
        slideTimers[slideshowId] = setTimeout(function() {
            plusSlides(1, slideshowId); // Automatically click "Next"
        }, 4000); // 4000ms = 4 seconds
    }
</script>
{% endblock %}