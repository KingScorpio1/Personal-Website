{% extends "base.html" %}
{% block title %}Portfolio - Sule Smith{% endblock %}

{% block content %}
<style>
    .category-badge {
        background-color: #3700b3;
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }
    
    /* Image Styles */
    .project-img, .slide img {
        width: 100%;
        height: 250px;
        object-fit: cover;
        border-radius: 5px;
        background-color: #333;
    }
    
    /* Slideshow Container */
    .slideshow-container {
        position: relative;
        width: 100%;
        height: 250px;
        margin-bottom: 15px;
        overflow: hidden;
        border-radius: 5px;
    }
    
    /* Hide slides by default */
    .slide {
        display: none;
        width: 100%;
        height: 100%;
    }
    
    /* Navigation buttons */
    .prev, .next {
        cursor: pointer;
        position: absolute;
        top: 50%;
        width: auto;
        padding: 10px;
        margin-top: -22px;
        color: white;
        font-weight: bold;
        font-size: 18px;
        transition: 0.3s ease;
        background-color: rgba(0,0,0,0.3);
        user-select: none;
        border-radius: 0 3px 3px 0;
        z-index: 10;
    }
    .next {
        right: 0;
        border-radius: 3px 0 0 3px;
    }
    .prev:hover, .next:hover {
        background-color: rgba(0,0,0,0.8);
    }

    /* Fade Animation */
    .fade {
        animation-name: fade;
        animation-duration: 1.5s;
    }
    @keyframes fade {
        from {opacity: .4} 
        to {opacity: 1}
    }

    /* --- MODAL STYLES (NOW OUTSIDE MEDIA QUERY) --- */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 2000; /* Increased to ensure it's on top */
        background-color: rgba(0,0,0,0.92);
        display: none; 
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        position: relative;
        width: 90%;
        max-width: 960px;
        aspect-ratio: 16 / 9;
        background: #000;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 15px 40px rgba(0,0,0,0.6);
        display: flex;
        flex-direction: column;
    }

    .close-btn {
        position: absolute;
        top: 10px;
        right: 20px;
        color: #fff;
        font-size: 42px;
        font-weight: bold;
        cursor: pointer;
        z-index: 100;
        text-shadow: 0 0 6px rgba(0,0,0,0.8);
    }

    /* Specific Mobile Tweaks */
    @media (max-width: 640px) {
        .modal-content {
            width: 96%;
            border-radius: 8px;
        }
        .close-btn {
            font-size: 32px;
            top: 5px;
            right: 12px;
        }
    }
</style>

<div style="text-align: center; padding: 2rem;">
    <h1>My Projects</h1>
    <p>Robotics, Software Development, and Engineering Design.</p>
</div>

<div class="portfolio-grid">
    {% for project in projects %}
    <div class="project-card">
        
        <!-- CASE 1: SLIDESHOW (Multiple Images) -->
        {% if project.images %}
            <div class="slideshow-container" id="slideshow-{{ loop.index }}">
                {% for img in project.images %}
                <div class="slide fade">
                    <img src="{{ url_for('static', filename='img/' + img) }}">
                </div>
                {% endfor %}
                
                <!-- Manual Controls -->
                <a class="prev" onclick="plusSlides(-1, 'slideshow-{{ loop.index }}')">‚ùÆ</a>
                <a class="next" onclick="plusSlides(1, 'slideshow-{{ loop.index }}')">‚ùØ</a>
            </div>

        <!-- CASE 2: SINGLE IMAGE -->
        {% elif project.image %}
            <img src="{{ url_for('static', filename='img/' + project.image) }}" alt="{{ project.title }}" class="project-img">
        {% endif %}

        <!-- Project Details -->
        <span class="category-badge">{{ project.category }}</span>
        <h3 style="margin-top: 10px;">{{ project.title }}</h3>
        <p>{{ project.description }}</p>
        <br>
        
        <!-- Buttons -->
        {% if project.video_url %}
            <a href="#" 
            onclick="openVideoModal('{{ project.video_url }}', '{{ project.title }}'); return false;" 
            class="btn" style="font-size: 0.9rem;">
                ‚ñ∂ {{ project.link_text }}
            </a>
        {% elif project.url and project.url != '#' %}
            <a href="{{ project.url }}" target="_blank" class="btn-outline" style="font-size: 0.9rem;">üîó {{ project.link_text }}</a>
        {% endif %}
    </div>
    {% endfor %}
</div>

<!-- Video Modal -->
<div id="videoModal" class="modal-overlay">
    <div class="modal-content">
        <div id="modalTitle" style="color: white; padding: 10px 20px; font-size: 1.2rem; background: #1a1a1a;"></div>
        
        <span onclick="closeVideoModal()" class="close-btn">√ó</span>
        
        <iframe id="videoIframe" style="width: 100%; height: 100%; border: none;" allowfullscreen></iframe>
    </div>
</div>

<!-- JavaScript for Auto-Play & Manual Slideshow -->
<script>
    // Objects to store the state of each slideshow
    let slideIndices = {}; // Keeps track of current slide number
    let slideTimers = {};  // Keeps track of the auto-play timer

    // Initialize all slideshows when page loads
    document.addEventListener("DOMContentLoaded", function() {
        let containers = document.querySelectorAll('.slideshow-container');
        containers.forEach(function(container) {
            let id = container.id;
            slideIndices[id] = 1; // Start at slide 1
            showSlides(1, id);    // Show it
        });
    });

    // Function called by Next/Prev buttons
    function plusSlides(n, slideshowId) {
        // 1. Stop the auto-player (so it doesn't jump immediately after you click)
        clearTimeout(slideTimers[slideshowId]);
        
        // 2. Calculate new index
        let current = slideIndices[slideshowId] || 1;
        
        // 3. Show new slide
        showSlides(current + n, slideshowId);
    }

    // Main function to display slides
    function showSlides(n, slideshowId) {
        let container = document.getElementById(slideshowId);
        if(!container) return;

        let slides = container.getElementsByClassName("slide");
        if(slides.length === 0) return;

        // Wrap around logic (Last -> First, First -> Last)
        if (n > slides.length) {n = 1}
        if (n < 1) {n = slides.length}
        
        // Update stored index
        slideIndices[slideshowId] = n;

        // Hide all slides
        for (let i = 0; i < slides.length; i++) {
            slides[i].style.display = "none";  
        }
        
        // Show the current slide
        slides[n-1].style.display = "block";  

        // 4. Restart the Auto-Play Timer (Run again in 4 seconds)
        // We clear any existing timer first just to be safe
        clearTimeout(slideTimers[slideshowId]);
        
        slideTimers[slideshowId] = setTimeout(function() {
            plusSlides(1, slideshowId); // Automatically click "Next"
        }, 4000); // 4000ms = 4 seconds
    }

    function openVideoModal(url, title) {
        // 1. Set the video source
        document.getElementById('videoIframe').src = url;
        
        // 2. Set the dynamic title
        document.getElementById('modalTitle').innerText = title;
        
        // 3. Show the modal using 'flex' to keep it centered
        document.getElementById('videoModal').style.display = 'flex';
    }

    function closeVideoModal() {
        document.getElementById('videoModal').style.display = 'none';
        document.getElementById('videoIframe').src = ''; 
        document.getElementById('modalTitle').innerText = ''; // Clear title on close
    }
    // Keep this to allow clicking outside to close
    window.onclick = function(event) {
        var modal = document.getElementById('videoModal');
        if (event.target == modal) {
            closeVideoModal();
        }
    }
</script>
{% endblock %}